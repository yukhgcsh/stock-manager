@page "/transactionRegister"
@using StockManager.Core.InputModels;
@using StockManager.Core.Services;
@using StockManager.Core.Utils;

@inject StockTransactionService transactionService;

<PageTitle>売買履歴</PageTitle>

<h1>売買履歴</h1>

<MudGrid>
    <MudItem xs="12" sm="12">
        <MudPaper Class="pa-4">
            <MudForm Model="@Data" @ref="@Form" @bind-IsValid="@IsValid">
                <MudTextField T="int" @bind-Value="Data.Code" Label="銘柄コード" Required="true" RequiredError="※必須" />
                <MudTextField T="string" @bind-Value="Data.Name" Label="会社名" Required="true" RequiredError="※必須" />
                <div class="d-flex">
                    <MudRadioGroup @bind-SelectedOption="Data.Type" T="TransactionType" Required="true" RequiredError="Account type is required!">
                        <MudRadio Option="@(TransactionType.Buy)">購入</MudRadio>
                        <MudRadio Option="@(TransactionType.Sell)">売却</MudRadio>
                    </MudRadioGroup>
                </div>
                <MudTextField T="int" @bind-Value="Data.Amount" Label="取引株数" Required="true" RequiredError="※必須" />
                <MudDatePicker @bind-Date="Date" Label="取引日" Required="true" RequiredError="※必須" />
                <MudTextField T="double" @bind-Value="Data.Price" Label="価格" Required="true" RequiredError="※必須" />
                <MudTextField T="int" Label="手数料" Required="false" />
                <MudTextField T="string" @bind-Value="Data.Memo" Label="メモ" Required="false" />
                <MudButton Variant="Variant.Filled" Color="Color.Primary" Disabled="@(!IsValid)" Class="ml-auto" OnClick="Register">登録</MudButton>
            </MudForm>
        </MudPaper>
    </MudItem>
</MudGrid>

@code {
    StockTransaction Data = new StockTransaction();
    bool IsValid = true;
    DateTime? Date;
    MudForm? Form;

    protected async Task Register()
    {
        this.Data.Date = this.Date!.Value;
        await transactionService.RegisterStockTransactionAsync(this.Data);
    }
}
